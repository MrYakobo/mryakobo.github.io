<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0">
    <script src="jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
    <meta name="theme-color" content="#000000">
    <title>Efternamnsgenerator</title>
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#003598">
    <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet" type="text/css"> </head>

<body onkeydown="keydown(event)">
    <h1 class="main-title">Efternamnsgeneratorn</h1>
    <div>
        <h2 class="intro">Är du inte säker på vad ditt nya efternamn ska vara? Har du och din partner idétorka på namn? Då är den här sidan för dig.</h2> <code>Skriv in två valfria namn för att kombinera dem. Generatorn ger dig ett antal förslag på nya efternamn.</code> </div>
    <input type="text" placeholder="Namn 1" id="name1" value="Bokerud">
    <input type="text" placeholder="Namn 2" id="name2" value="Adamsson">
    <div class="form">
        <div class="form">
            <input type="checkbox" id="wordlist">
            <label for="wordlist">Kolla med ordlista</label>
        </div> <code>(kan ta extra lång tid och ge (fler) skumma resultat)</code> </div>
    <div class="hidden" data-dialog="result">
        <h1 class="result">Resultat</h1>
        <p id="result">Resultatet visas här</p>
    </div>
    <button onclick="gen()" data-dialog="result">Generera efternamn!!</button> <img src="loading.gif" id="loading"> </body>
<script>
    function keydown(e){
        if(e.keyCode == 13)
            gen();
        else
            overlayClick('result');
    }

    Array.prototype.random = function () {
        return this[Math.floor(Math.random() * this.length)];
    }
    var names = ['Abrahamsson', 'Adamsson', 'Ahlberg', 'Andersson', 'Johansson', 'Karlsson', 'Nilsson', 'Eriksson', 'Lindström', 'Lindskog', 'Lindqvist', 'Wikström', 'Söderberg'];
    $("#name1").val(names.random());
    $("#name2").val(names.random());
    var vowels = ['a', 'o', 'u', 'å', 'e', 'i', 'y', 'ä', 'ö'];
    //Formatting
    //    Array.prototype.toString = function () {
    //        var a = "";
    //        for (var i = 0; i < this.length - 1; i++) {
    //            if (this[i] != "undefined") a += this[i] + ", ";
    //        }
    //        a += this[this.length - 1];
    //        return a;
    //    }
    Array.prototype.toTable = function () {
        var a = "<table>";
        for (var i = 0; i < this.length - 1; i++) {
            if (this[i] != "undefined") {
                a += "<tr><td>" + this[i] + "</td></tr>";
            }
        }
        a += "<tr><td>" + this[this.length - 1] + "</td></tr></table>";
        return a;
    }
    var oldCheck = false;
    var oldN = "";
    var oldM = "";
    
    //Name generates the names (based on vowels)
    function name(name1, name2) {
        var retVal = [];
        for (var i = 0; i < vowels.length; i++) {
            if (name1.indexOf(vowels[i]) > -1 || name2.indexOf(vowels[i]) > -1) {
                var newName = name1.substring(0, name1.indexOf(vowels[i]) + 1) + name2.substring(name2.indexOf(vowels[i]) - 1);
                newName = newName.capitalize();
                //If the generated name is not the same as name1/name2
                if (newName != name1 && newName != name2) retVal.push(newName);
            }
        }
        return retVal;
    }

    function gen() {
        $("body").css("cursor", "progress");
        var n = document.getElementById("name1").value;
        var m = document.getElementById("name2").value;
        var checked = document.getElementById("wordlist").checked;
        //If not the same input as before
        if (oldN != n || oldM != m || oldCheck != checked) {
            oldN = n;
            oldM = m;
            oldCheck = checked;
            /*        
            The final name is generated by taking what's before the first vowel in n plus what's after the first vowel in m.
            */
            var finalNames = [];
            var time = Date.now();
            if (checked) {
                //Adds wordlist-names to the final names
                finalNames = wordList(n, m);
            }
            
            console.log(finalNames);
            
//            finalNames.push(name(n, m));
//            finalNames.push(name(m, n));
            finalNames = finalNames.concat(name(n,m));
            finalNames = finalNames.concat(name(m,n));
            //Result
            var reg = new RegExp(",?undefined,?");
            console.log(finalNames);
            document.getElementById("result").innerHTML = finalNames.toTable();
            console.info("Executed in " + (Date.now() - time) + " ms.");
        }
        dialog("result");
        $("body").css("cursor", "");
    }
    var words = [];

    function loadWords() {
        //var root = "http://" + location.hostname + location.pathname;
        $.get("swe.json", function (data) {
//            words = data.split("\n");
//            words = JSON.parse(data);
            words = data;
            console.log("Loaded words");
        });
    }

    function wordList(name1, name2) {
        var firstPart = [];
        var secondPart = [];
        name1 = name1.toLowerCase();
        name2 = name2.toLowerCase();
        for (let i = 0; i < words.length; i++) {
            //Searches the list for words that exists in name1 and/or name2
            //"blindskrift" matches "lind" in "lindskog"
            //The matched word (in words[]) has to match the whole word into a bit of the name.
            /*
            words[i] = Lind
            name1 = Lindskog
            name2 = Smedberg
            */
            var reg = new RegExp(words[i].replace("\r", "").toLowerCase());
            var res1 = reg.exec(name1);
            var res2 = reg.exec(name2);
            if (res1 != null && res1[0].length > 3) {
                firstPart.push(reg.exec(name1));
            }
            if (res2 != null && res2[0].length > 3) {
                secondPart.push(reg.exec(name2));
            }
        }
        var retVal = mixArrays(firstPart, secondPart);
        return retVal != null ? retVal : [];
    }

    function mixArrays(arr1, arr2) {
        //If one array is empty, return the other array (may be empty as well)
        if (arr1.length == 0 || arr2.length == 0) return arr1.length == 0 ? arr2.capitalizeElements() : arr1.capitalizeElements();
        var retVal = [];
        for (var i = 0; i < arr1.length; i++) {
            for (var j = 0; j < arr2.length; j++) {
                retVal.push((arr1[i] + arr2[j]).capitalize());
            }
        }
        return retVal;
    }
    Array.prototype.capitalizeElements = function () {
        for (let i = 0; i < this.length; i++) {
            this[i] = this[i].toString().capitalize();
        }
    }
    loadWords();
    String.prototype.capitalize = function () {
        return this.charAt(0).toUpperCase() + this.slice(1).toLowerCase();
    }
</script>
<script src="http://vab.kodlabb.se/Library/dialog/dialog.js"></script>

</html>